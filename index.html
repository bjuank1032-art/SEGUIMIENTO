<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sistema 3 de Junio Pro v12.5</title>
    
    <!-- Configuraci√≥n para App iPhone -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/96/cannabis.png">
    
    <!-- Scripts de Dependencias -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --accent-blue: #007aff;
            --metal-shine: linear-gradient(135deg, #48484a 0%, #1c1c1e 50%, #000000 100%);
        }

        body {
            background-color: black;
            color: #e5e5e5;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
            padding-top: var(--safe-top);
            padding-bottom: calc(var(--safe-bottom) + 160px);
        }

        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px) rotate(-1deg); }
            75% { transform: translateX(3px) rotate(1deg); }
        }

        .failure-alert { animation: shake 0.2s ease-in-out infinite; }
        
        @keyframes pulse-red-soft {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4); border-color: rgba(255, 59, 48, 0.3); }
            50% { box-shadow: 0 0 20px 0 rgba(255, 59, 48, 0.1); border-color: rgba(255, 59, 48, 0.6); }
        }

        .btn-defense-waiting { animation: pulse-red-soft 2s infinite; }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #2c2c2e; border-radius: 10px; }

        input, textarea { font-size: 16px !important; }

        .glass-modal {
            background: rgba(23, 23, 23, 0.8) !important;
            backdrop-filter: blur(25px) !important;
            -webkit-backdrop-filter: blur(25px) !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .roadmap-line-gradient { background: linear-gradient(to bottom, #ef4444, #f97316, #3b82f6, #10b981, #a855f7) !important; }

        .btn-gear-pro {
            background: var(--metal-shine);
            border: 2px solid #545456;
            box-shadow: 0 0 0 2px #000, 0 10px 20px rgba(0,0,0,0.6), inset 0 2px 2px rgba(255,255,255,0.2);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-gear-pro:active { transform: scale(0.9) rotate(180deg); border-color: var(--accent-blue); }

        .modal-header-btn {
            padding: 10px 18px;
            background: rgba(255,255,255,0.1);
            border-radius: 14px;
            font-size: 11px;
            font-weight: 900;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .emoji-span { font-size: 1.6rem; display: flex; align-items: center; justify-content: center; }
        .routine-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = "w-5 h-5", color = "currentColor", fill = "none" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (!iconRef.current) return;
                iconRef.current.innerHTML = '';
                const isEmoji = /\p{Emoji}/u.test(name) && !/^[a-zA-Z0-9-]+$/.test(name);
                if (isEmoji) {
                    iconRef.current.innerHTML = `<span class="emoji-span">${name}</span>`;
                } else if (window.lucide) {
                    const i = document.createElement('i');
                    const lucideName = name.replace(/([a-z])([A-Z0-9])/g, '$1-$2').toLowerCase();
                    i.setAttribute('data-lucide', lucideName);
                    i.className = className;
                    i.style.stroke = color;
                    i.style.fill = fill;
                    i.style.strokeWidth = "2.5";
                    iconRef.current.appendChild(i);
                    window.lucide.createIcons();
                }
            }, [name, className, color, fill]);
            return <span ref={iconRef} className="flex items-center justify-center pointer-events-none min-w-[1.5rem] min-h-[1.5rem]"></span>;
        };

        const apiKey = ""; 
        const KEY_H = 'res_v11_habits';
        const KEY_S = 'res_v11_start';
        const KEY_W = 'last_win_date';
        const PRESET_COLORS = ["#007aff", "#34c759", "#ff3b30", "#ff9500", "#af52de", "#ff2d55"];

        const getLocalISODate = () => {
            const hoy = new Date();
            const offset = hoy.getTimezoneOffset() * 60000;
            return (new Date(hoy - offset)).toISOString().split('T')[0];
        };

        const getDayName = (dateStr) => {
            const days = ['dom', 'lun', 'mar', 'mie', 'jue', 'vie', 'sab'];
            const date = new Date(dateStr + "T12:00:00");
            return days[date.getDay()];
        };

        const INITIAL_HABITS = [
            { id: 'h1', name: "Ejercicio", icon: "üèãÔ∏è", color: "#007aff", type: "routine", routine: { lun: 'Pecho y Tr√≠ceps', mar: 'Espalda y B√≠ceps', mie: 'Pierna y Core', jue: 'Hombros', vie: 'Brazos', sab: 'Caminata', dom: '' }, restDays: ['dom'], history: [] },
            { id: 'h2', name: "Splendor", icon: "‚ú®", color: "#ff9500", type: "simple", history: [] },
            { id: 'h3', name: "Purga", icon: "üö´", color: "#ff3b30", type: "simple", history: [] }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('seguimiento'); 
            const [habits, setHabits] = useState([]);
            const [startDate, setStartDate] = useState(getLocalISODate());
            const [expandedId, setExpandedId] = useState(null);
            const [expandedStep, setExpandedStep] = useState(1);
            
            const [showAddModal, setShowAddModal] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showJuez, setShowJuez] = useState(false);
            
            const [reflection, setReflection] = useState("");
            const [aiFeedback, setAiFeedback] = useState("");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [verdictValid, setVerdictValid] = useState(null);

            const [editingHabitId, setEditingHabitId] = useState(null);
            const [newName, setNewName] = useState("");
            const [newIcon, setNewIcon] = useState("üî•");
            const [selectedColor, setSelectedColor] = useState(PRESET_COLORS[0]);
            const [habitType, setHabitType] = useState('simple'); 
            const [routineData, setRoutineData] = useState({ lun:'', mar:'', mie:'', jue:'', vie:'', sab:'', dom:'' });
            const [restDays, setRestDays] = useState(['dom']);

            useEffect(() => {
                const savedHabits = JSON.parse(localStorage.getItem(KEY_H)) || INITIAL_HABITS;
                const savedStart = localStorage.getItem(KEY_S) || getLocalISODate();
                setHabits(savedHabits);
                setStartDate(savedStart);
                checkJuezStatus(savedHabits);
            }, []);

            useEffect(() => {
                localStorage.setItem(KEY_H, JSON.stringify(habits));
                localStorage.setItem(KEY_S, startDate);
            }, [habits, startDate]);

            const checkJuezStatus = (currentHabits) => {
                const lastWin = localStorage.getItem(KEY_W);
                if (!lastWin) return;
                const diff = Math.floor((new Date() - new Date(lastWin)) / (1000 * 60 * 60 * 24));
                if (diff >= 7) setShowJuez(true);
            };

            const getFailurePercentage = () => {
                const lastWin = localStorage.getItem(KEY_W);
                if (!lastWin) return 0;
                const diff = Math.floor((new Date() - new Date(lastWin)) / (1000 * 60 * 60 * 24));
                return Math.min(100, diff * 20); // 20% por d√≠a de inactividad
            };

            const failurePorc = getFailurePercentage();

            const getAIDynamicContext = () => {
                const listaMetas = habits.map(h => `- ${h.name} (${h.type}): ${h.history.length} victorias`).join('\n');
                return `
                Eres el JUEZ y MENTOR del "Sistema 3 de Junio". No eres amable. Eres un coach de choque.
                PERFIL USUARIO: 1.77m, 57kg (objetivo: dejar de ser un fideo).
                META: Estudiante UdeA y marca Splendor. Purga de h√°bitos (Cero marihuana desde 24 Feb).
                
                CONTEXTO ACTUAL:
                ${listaMetas}
                Inactividad actual: ${Math.floor(failurePorc / 20)} d√≠as.
                
                REGLAS:
                - S√© √°cido. Si falla, hum√≠llalo por su peso (57kg).
                - Diferencia: Purga es SUPERVIVENCIA. Lectura/Estudio es SOPORTE.
                - Si el fracaso es > 70%, s√© brutal.
                `;
            };

            const consultarAlJuez = async () => {
                if (reflection.trim().length < 10) return;
                setIsAiLoading(true);
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `He vuelto tras ${Math.floor(failurePorc / 20)} d√≠as. Mi reflexi√≥n: "${reflection}". Dame tu veredicto.` }] }],
                            systemInstruction: { parts: [{ text: getAIDynamicContext() }] },
                            generationConfig: { responseMimeType: "application/json", responseSchema: { type: "OBJECT", properties: { valid: { type: "boolean" }, verdict: { type: "string" } } } }
                        })
                    });
                    const data = await response.json();
                    const result = JSON.parse(data.candidates?.[0]?.content?.parts?.[0]?.text);
                    setAiFeedback(result.verdict);
                    setVerdictValid(result.valid);
                } catch (e) {
                    setAiFeedback("Error de tribunal. El Sistema otorga desbloqueo t√©cnico por hoy.");
                    setVerdictValid(true);
                } finally {
                    setIsAiLoading(false);
                }
            };

            const handleMark = (id) => {
                const hoy = getLocalISODate();
                setHabits(prev => prev.map(h => {
                    if (h.id === id && !h.history.includes(hoy)) {
                        return { ...h, history: [...h.history, hoy] };
                    }
                    return h;
                }));
                localStorage.setItem(KEY_W, new Date().toISOString());
            };

            const handleUndo = (id, e) => {
                e.stopPropagation();
                const hoy = getLocalISODate();
                setHabits(prev => prev.map(h => h.id === id ? { ...h, history: h.history.filter(d => d !== hoy) } : h));
            };

            const calculatePorc = (h) => {
                const start = new Date(startDate + "T12:00:00");
                const hoy = new Date(); hoy.setHours(12, 0, 0, 0);
                const diff = Math.max(1, Math.floor((hoy - start) / (1000 * 60 * 60 * 24)) + 1);
                let totalEsperado = diff;
                if (h.type === 'routine' && h.restDays) {
                    let restCount = 0;
                    let temp = new Date(start);
                    while (temp <= hoy) {
                        const dName = ['dom', 'lun', 'mar', 'mie', 'jue', 'vie', 'sab'][temp.getDay()];
                        if (h.restDays.includes(dName)) restCount++;
                        temp.setDate(temp.getDate() + 1);
                    }
                    totalEsperado = Math.max(1, diff - restCount);
                }
                return Math.min(100, Math.round((h.history.length / totalEsperado) * 100));
            };

            const getGlobalStats = () => {
                if (habits.length === 0) return 0;
                let total = 0;
                habits.forEach(h => total += calculatePorc(h));
                return Math.round(total / habits.length);
            };

            const saveHabit = () => {
                if (!newName) return;
                const habitData = {
                    name: newName, icon: newIcon, color: selectedColor,
                    type: habitType, routine: habitType === 'routine' ? routineData : null,
                    restDays: habitType === 'routine' ? restDays : []
                };
                if (editingHabitId) {
                    setHabits(prev => prev.map(h => h.id === editingHabitId ? { ...h, ...habitData } : h));
                    setEditingHabitId(null);
                } else {
                    setHabits([...habits, { id: 'h' + Date.now(), ...habitData, history: [] }]);
                }
                resetForm(); setShowAddModal(false);
            };

            const resetForm = () => {
                setEditingHabitId(null); setNewName(""); setNewIcon("üî•");
                setSelectedColor(PRESET_COLORS[0]); setHabitType('simple');
                setRoutineData({ lun:'', mar:'', mie:'', jue:'', vie:'', sab:'', dom:'' });
                setRestDays(['dom']);
            };

            const openEditModal = (h) => {
                setEditingHabitId(h.id); setNewName(h.name); setNewIcon(h.icon);
                setSelectedColor(h.color); setHabitType(h.type || 'simple');
                setRoutineData(h.routine || { lun:'', mar:'', mie:'', jue:'', vie:'', sab:'', dom:'' });
                setRestDays(h.restDays || ['dom']);
                setShowSettings(false); setShowAddModal(true);
            };

            const hoyStr = getLocalISODate();
            const hoyDayName = getDayName(hoyStr);

            const allObjectives = [
                { id: "1", text: "Dejar de fumar marihuana" }, { id: "2", text: "UdeA (Acad√©mico)" }, { id: "3", text: "Masa Muscular" }, { id: "4", text: "Meditar" }, { id: "5", text: "Control Mental" }, { id: "6", text: "6:30 AM" }, { id: "7", text: "10:30 PM" }, { id: "8", text: "Ingl√©s y Excel" }, { id: "9", text: "Empleo" }, { id: "10", text: "SPLENDOR" }, { id: "11", text: "Dinero" }, { id: "12", text: "Cabello" }
            ];

            const steps = [
                { id: 1, title: "Nivel 1: Reset", icon: 'üî•', tag: "Fase 1", objectives: ["1", "6", "7"], tasks: ["Purga estricta", "Sin contacto con consumo", "Sue√±o 10:30 PM"], impact: "Voluntad biol√≥gica base.", color: "border-red-500/50", iconColor: "text-red-400" },
                { id: 2, title: "Nivel 2: Estabilidad", icon: 'üß†', tag: "Fase 2", objectives: ["2", "3", "9"], tasks: ["Meditaci√≥n", "Ejercicio intenso", "B√∫squeda empleo"], impact: "Eliminar incertidumbre.", color: "border-orange-500/50", iconColor: "text-orange-400" },
                { id: 3, title: "Nivel 3: Deep Work", icon: 'üìñ', tag: "Fase 3", objectives: ["8"], tasks: ["Lectura 15p", "Excel profundo"], impact: "Competencia t√©cnica.", color: "border-blue-500/50", iconColor: "text-blue-400" },
                { id: 4, title: "Nivel 4: Consolidaci√≥n", icon: 'üíº', tag: "Fase 4", objectives: ["11", "12"], tasks: ["Gesti√≥n ingresos", "Tratamiento capilar"], impact: "Herramientas de libertad.", color: "border-emerald-500/50", iconColor: "text-emerald-400" },
                { id: 5, title: "Nivel 5: Splendor", icon: '‚ú®', tag: "Final", objectives: ["10"], tasks: ["Lanzamiento marca", "Manifestaci√≥n total"], impact: "Consolidaci√≥n 3 de Junio.", color: "border-purple-500/50", iconColor: "text-purple-400" }
            ];

            const renderSeguimiento = () => (
                <div className="animate-in pb-32">
                    <header className="mb-10 px-6 flex justify-between items-center pt-4">
                        <div>
                            <h1 className="text-4xl font-black italic tracking-tighter text-white uppercase leading-none">Seguimiento</h1>
                            <p className="text-[10px] font-black text-neutral-500 uppercase tracking-[0.2em] mt-3">Misi√≥n Activa ‚Ä¢ {habits.length} Metas</p>
                        </div>
                        <button onClick={() => setShowSettings(true)} className="w-16 h-16 btn-gear-pro rounded-full flex items-center justify-center text-white active:rotate-90">
                            <Icon name="Settings" className="w-8 h-8" color="#F2F2F7" />
                        </button>
                    </header>

                    {/* DASHBOARD DE BARRAS */}
                    <div className="grid gap-4 px-4 mb-10">
                        {/* BARRA PROGRESO GLOBAL */}
                        <div className="bg-neutral-900/60 border border-neutral-800 p-8 rounded-[2.8rem] shadow-2xl backdrop-blur-md">
                            <div className="flex justify-between items-baseline mb-5">
                                <span className="text-[11px] font-black text-neutral-500 tracking-[0.2em] uppercase">Eficacia Hoy</span>
                                <span className="text-5xl font-black text-white italic tracking-tighter">{getGlobalStats()}%</span>
                            </div>
                            <div className="h-4 bg-black rounded-full overflow-hidden border border-neutral-800 p-[2px]">
                                <div className="h-full bg-gradient-to-r from-blue-600 to-emerald-500 rounded-full transition-all duration-1000" style={{ width: `${getGlobalStats()}%` }} />
                            </div>
                        </div>

                        {/* BARRA DEL FRACASADO */}
                        <div className={`bg-neutral-900/40 border p-8 rounded-[2.8rem] transition-all duration-500 ${failurePorc > 70 ? 'failure-alert border-red-600 bg-red-950/20' : 'border-neutral-800'}`}>
                            <div className="flex justify-between items-baseline mb-5">
                                <span className={`text-[11px] font-black uppercase tracking-[0.2em] ${failurePorc > 70 ? 'text-red-500 animate-pulse' : 'text-neutral-600'}`}>
                                    Ser un fracasado
                                </span>
                                <span className={`text-5xl font-black italic tracking-tighter ${failurePorc > 70 ? 'text-red-500' : 'text-neutral-700'}`}>{failurePorc}%</span>
                            </div>
                            <div className="h-4 bg-black rounded-full overflow-hidden border border-neutral-800 p-[2px]">
                                <div className={`h-full transition-all duration-1000 rounded-full ${failurePorc > 70 ? 'bg-red-600' : failurePorc > 30 ? 'bg-orange-600' : 'bg-neutral-800'}`} style={{ width: `${failurePorc}%` }} />
                            </div>
                        </div>
                    </div>

                    <div className="px-4 grid gap-5">
                        {habits.map(h => {
                            const porc = calculatePorc(h);
                            const markedToday = h.history.includes(hoyStr);
                            const isRest = h.type === 'routine' && h.restDays?.includes(hoyDayName);
                            const isExpanded = expandedId === h.id;

                            return (
                                <div key={h.id} onClick={() => h.type === 'routine' ? setExpandedId(isExpanded ? null : h.id) : handleMark(h.id)}
                                    className={`routine-card bg-neutral-900/40 border border-neutral-800 rounded-[2.5rem] p-7 relative transition-all overflow-hidden ${markedToday || isRest ? 'opacity-50' : 'cursor-pointer active:scale-95'}`} 
                                    style={{ borderLeft: `12px solid ${isRest ? '#333' : h.color}` }}>
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center gap-5">
                                            <div className="w-14 h-14 bg-black rounded-2xl flex items-center justify-center border border-neutral-800">
                                                <Icon name={h.icon} className="w-8 h-8" />
                                            </div>
                                            <div>
                                                <h3 className="text-2xl font-bold text-white italic leading-none mb-1">{h.name}</h3>
                                                {h.type === 'routine' && <span className="text-[8px] font-black uppercase tracking-widest text-neutral-500 bg-neutral-800 px-2 py-0.5 rounded">{isRest ? 'Descanso' : 'Sistema'}</span>}
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            {h.type === 'routine' && <Icon name="ChevronDown" className={`w-5 h-5 text-neutral-600 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />}
                                            {!isRest && <button onClick={(e) => handleUndo(h.id, e)} className="w-12 h-12 bg-black rounded-2xl border border-neutral-800 flex items-center justify-center text-neutral-500"><Icon name="Undo2" className="w-6 h-6" /></button>}
                                        </div>
                                    </div>
                                    {h.type === 'routine' && isExpanded && (
                                        <div className="mt-8 animate-in">
                                            <div className="bg-black/60 rounded-3xl p-6 border border-neutral-800/50">
                                                <p className="text-sm font-bold italic text-neutral-200">{isRest ? "Recuperaci√≥n estrat√©gica." : (h.routine?.[hoyDayName] || "Mantenimiento.")}</p>
                                            </div>
                                            {!isRest && !markedToday && <button onClick={(e) => { e.stopPropagation(); handleMark(h.id); }} className="w-full mt-6 py-5 bg-white text-black font-black rounded-3xl uppercase text-[10px] tracking-widest active:scale-95">Marcar Victoria</button>}
                                        </div>
                                    )}
                                    {!isExpanded && (
                                        <div className="mt-6">
                                            <div className="h-3.5 bg-black rounded-full overflow-hidden mb-4 border border-neutral-800 p-[2px]"><div className="h-full transition-all duration-1000 rounded-full" style={{ width: `${porc}%`, backgroundColor: isRest ? '#333' : h.color }} /></div>
                                            <div className="flex justify-between text-[11px] font-black uppercase tracking-widest text-neutral-500"><span>Victorias: {h.history.length}</span><span style={{ color: isRest ? '#666' : h.color }}>{porc}% Eficacia</span></div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                        <div onClick={() => { resetForm(); setShowAddModal(true); }} className="border-2 border-dashed border-neutral-800 rounded-[2.5rem] p-12 flex flex-col items-center justify-center gap-4 text-neutral-600 cursor-pointer bg-neutral-900/10 mt-2">
                            <Icon name="Plus" className="w-10 h-10" />
                            <span className="text-xs font-black uppercase tracking-[0.2em]">A√±adir Misi√≥n</span>
                        </div>
                    </div>
                </div>
            );

            const renderRoadmap = () => (
                <div className="animate-in pb-32 px-4">
                    <header className="mb-10 border-b border-neutral-800 pb-8 pt-4">
                        <div className="flex items-center gap-4 mb-3">
                            <Icon name="Zap" className="w-8 h-8" />
                            <h1 className="text-3xl font-black tracking-tighter text-white uppercase italic">Plan Maestro</h1>
                        </div>
                        <p className="text-[11px] text-neutral-500 font-bold uppercase tracking-[0.3em]">REINGENIER√çA PERSONAL ‚Ä¢ 3 DE JUNIO</p>
                    </header>
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        <div className="lg:col-span-4 space-y-8">
                            <div className="bg-neutral-900/40 border border-neutral-800/60 p-7 rounded-[2.8rem] sticky top-8 backdrop-blur-md">
                                <h2 className="text-[10px] font-black uppercase tracking-[0.25em] text-neutral-400 mb-8 flex items-center gap-3"><Icon name="List" className="w-5 h-5 text-purple-400" /> Los 12 Objetivos</h2>
                                <div className="space-y-3">{allObjectives.map((obj) => (<div key={obj.id} className="flex items-center gap-4 p-2 rounded-xl border border-transparent hover:bg-white/5 transition-all group"><div className="w-7 h-7 rounded-xl bg-neutral-800 flex items-center justify-center text-[10px] font-bold text-neutral-400 italic shrink-0">{obj.id}</div><span className="text-xs font-medium text-neutral-200 group-hover:text-white truncate tracking-tight">{obj.text}</span></div>))}</div>
                            </div>
                        </div>
                        <div className="lg:col-span-8 relative">
                            <div className="absolute left-6 top-0 bottom-0 w-1 roadmap-line-gradient rounded-full opacity-60"></div>
                            <div className="space-y-8">{steps.map((step) => (
                                <div key={step.id} onClick={() => setExpandedStep(step.id)} className="relative pl-16 group cursor-pointer">
                                    <div className={`absolute left-0 top-0 w-14 h-14 rounded-[1.2rem] flex items-center justify-center z-10 border-2 transition-all duration-500 ${expandedStep === step.id ? 'bg-white text-black border-white shadow-[0_0_20px_rgba(255,255,255,0.2)] scale-110' : 'bg-black text-neutral-600 border-neutral-800'}`}><span className="font-black italic text-xl">{step.id}</span></div>
                                    <div className={`p-8 md:p-10 rounded-[3rem] border-2 transition-all duration-500 ${expandedStep === step.id ? `${step.color} bg-neutral-900/60 shadow-2xl backdrop-blur-md` : 'border-transparent bg-neutral-900/10 opacity-30 group-hover:opacity-60'}`}>
                                        <div className="flex flex-col md:flex-row justify-between items-start gap-5 mb-8"><div className="flex items-center gap-5"><div className="p-3 bg-neutral-800 rounded-2xl"><Icon name={step.icon} className={`w-6 h-6 ${expandedStep === step.id ? step.iconColor : 'text-neutral-500'}`} /></div><div><h3 className="text-2xl md:text-3xl font-black text-white italic uppercase tracking-tighter leading-none">{step.title}</h3><span className="text-[10px] font-black uppercase tracking-[0.2em] text-neutral-500 block mt-2">{step.tag}</span></div></div></div>
                                        {expandedStep === step.id && (<div className="grid grid-cols-1 md:grid-cols-2 gap-10 animate-in mt-6"><div className="space-y-5"><h4 className="text-[11px] font-black text-neutral-500 uppercase tracking-[0.3em] flex items-center gap-3 border-b border-neutral-800 pb-3">üöÄ Ejecuci√≥n</h4><ul className="space-y-4">{step.tasks.map((task, i) => (<li key={i} className="flex items-start gap-4 group/task"><div className="mt-2 w-2 h-2 rounded-full bg-neutral-700 shrink-0"></div><span className="text-sm font-semibold text-neutral-300 leading-tight">{task}</span></li>))}</ul></div><div className="space-y-6"><div className="p-6 bg-black/50 rounded-[2.5rem] border border-neutral-800 shadow-inner"><h4 className="text-[10px] font-black text-neutral-500 uppercase tracking-[0.25em] mb-4">Meta Final</h4><p className="text-xs text-neutral-400 italic">{step.impact}</p></div><div className="flex flex-wrap gap-2">{step.objectives.map(objId => (<span key={objId} className="bg-neutral-800 text-neutral-400 text-[9px] font-black px-3 py-1.5 rounded-lg border border-neutral-700">OBJ {objId}</span>))}</div></div></div>)}
                                    </div>
                                </div>
                            ))}</div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-black text-neutral-200 font-sans selection:bg-white selection:text-black">
                    <div className="max-w-4xl mx-auto relative pt-6">
                        {activeTab === 'seguimiento' ? renderSeguimiento() : renderRoadmap()}
                        <nav className="fixed bottom-8 left-1/2 -translate-x-1/2 bg-neutral-900/90 backdrop-blur-3xl border border-neutral-800 rounded-[3rem] p-2.5 flex gap-3 shadow-2xl z-[100] w-[90%] max-w-sm">
                            <button onClick={() => setActiveTab('seguimiento')} className={`flex-1 flex items-center justify-center gap-3 py-4 rounded-[2.5rem] transition-all duration-500 font-black uppercase text-[11px] tracking-[0.2em] ${activeTab === 'seguimiento' ? 'bg-white text-black shadow-2xl scale-105' : 'text-neutral-500'}`}><Icon name="Activity" className="w-4 h-4" /> <span>Metas</span></button>
                            <button onClick={() => setActiveTab('roadmap')} className={`flex-1 flex items-center justify-center gap-3 py-4 rounded-[2.5rem] transition-all duration-500 font-black uppercase text-[11px] tracking-[0.2em] ${activeTab === 'roadmap' ? 'bg-white text-black shadow-2xl scale-105' : 'text-neutral-500'}`}><Icon name="Map" className="w-4 h-4" /> <span>Ruta</span></button>
                        </nav>

                        {/* MODALES: A√ëADIR, AJUSTES, JUEZ */}
                        {showAddModal && (
                            <div className="fixed inset-0 bg-black/50 z-[2000] flex items-center justify-center p-5 animate-in">
                                <div className="glass-modal w-full max-w-md max-h-[90vh] overflow-y-auto rounded-[3.5rem] p-8 custom-scrollbar">
                                    <div className="flex justify-between items-center mb-10 border-b border-neutral-800 pb-6"><h2 className="text-2xl font-black italic text-white uppercase">{editingHabitId ? "Editar" : "Crear"} Meta</h2><button onClick={() => setShowAddModal(false)} className="modal-header-btn">Cerrar</button></div>
                                    <div className="space-y-8">
                                        <div className="flex bg-black p-1.5 rounded-2xl border border-neutral-800">
                                            <button onClick={() => setHabitType('simple')} className={`flex-1 py-3 rounded-xl text-[9px] font-black uppercase ${habitType === 'simple' ? 'bg-neutral-800 text-white' : 'text-neutral-600'}`}>Meta Simple</button>
                                            <button onClick={() => setHabitType('routine')} className={`flex-1 py-3 rounded-xl text-[9px] font-black uppercase ${habitType === 'routine' ? 'bg-neutral-800 text-white' : 'text-neutral-600'}`}>Sistema Rutina</button>
                                        </div>
                                        <div className="grid gap-6">
                                            <div><label className="text-[10px] font-black text-neutral-500 uppercase mb-2 block">Nombre</label><input type="text" value={newName} onChange={e => setNewName(e.target.value)} className="w-full bg-black border border-neutral-800 rounded-2xl p-4 text-white outline-none" placeholder="Ej: No fumar" /></div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="text-[10px] font-black text-neutral-500 uppercase mb-2 block">Icono/Emoji</label><input type="text" value={newIcon} onChange={e => setNewIcon(e.target.value)} className="w-full bg-black border border-neutral-800 rounded-2xl p-4 text-white text-center text-2xl" placeholder="üî•" /></div>
                                                <div><label className="text-[10px] font-black text-neutral-500 uppercase mb-2 block">Color</label><div className="h-[58px] rounded-2xl border border-neutral-800 bg-black flex items-center justify-center relative overflow-hidden"><div className="w-6 h-6 rounded-full" style={{backgroundColor: selectedColor}}></div><input type="color" className="absolute opacity-0 inset-0" onChange={e => setSelectedColor(e.target.value)} /></div></div>
                                            </div>
                                        </div>
                                        {habitType === 'routine' && (<div className="space-y-4"><h4 className="text-[10px] font-black text-neutral-500 uppercase">Plan de Operaci√≥n</h4>{['lun', 'mar', 'mie', 'jue', 'vie', 'sab', 'dom'].map(day => (
                                            <div key={day} className="flex flex-col gap-2 p-4 bg-black/40 rounded-2xl border border-neutral-800/50">
                                                <div className="flex justify-between items-center"><span className="text-[10px] font-black uppercase text-neutral-400">{day}</span><button onClick={() => setRestDays(prev => prev.includes(day) ? prev.filter(d => d !== day) : [...prev, day])} className={`text-[8px] font-black px-3 py-1 rounded-full uppercase border ${restDays.includes(day) ? 'bg-blue-600 border-blue-500 text-white' : 'border-neutral-800 text-neutral-600'}`}>{restDays.includes(day) ? 'Descanso' : 'Misi√≥n'}</button></div>
                                                {!restDays.includes(day) && (<textarea value={routineData[day]} onChange={e => setRoutineData({...routineData, [day]: e.target.value})} placeholder="Tarea espec√≠fica..." className="w-full bg-black border border-neutral-800 p-3 rounded-xl text-xs text-neutral-300 min-h-[50px] resize-none" />)}
                                            </div>
                                        ))}</div>)}
                                        <button onClick={saveHabit} className="w-full bg-white text-black font-black py-6 rounded-3xl mt-6 uppercase text-sm tracking-[0.25em]">Sincronizar Misi√≥n</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showSettings && (
                            <div className="fixed inset-0 bg-black/50 z-[2000] flex items-center justify-center p-5 animate-in">
                                <div className="glass-modal w-full max-w-md max-h-[88vh] overflow-y-auto rounded-[3.5rem] p-10 relative custom-scrollbar shadow-2xl">
                                    <div className="flex justify-between items-center mb-10 border-b border-neutral-800 pb-6"><h2 className="text-3xl font-black italic text-white uppercase">Gesti√≥n</h2><button onClick={() => setShowSettings(false)} className="modal-header-btn">Cerrar</button></div>
                                    <div className="space-y-6">{habits.map((h) => (<div key={h.id} className="flex justify-between items-center bg-black/40 border border-neutral-800 p-5 rounded-3xl"><span className="text-sm font-bold text-neutral-300 flex items-center gap-3"><Icon name={h.icon} className="w-4 h-4" /> {h.name}</span><div className="flex gap-2"><button onClick={() => openEditModal(h)} className="p-3 bg-neutral-800 rounded-xl"><Icon name="Pencil" className="w-4 h-4" color="#fff" /></button><button onClick={() => { if(confirm("¬øEliminar?")) setHabits(habits.filter(hab => hab.id !== h.id)); }} className="p-3 bg-red-500/10 rounded-xl"><Icon name="Trash2" className="w-4 h-4" color="#ff3b30" /></button></div></div>))}</div>
                                </div>
                            </div>
                        )}

                        {showJuez && (
                            <div className="fixed inset-0 bg-black/95 z-[3000] flex items-center justify-center p-5 animate-in">
                                <div className="glass-modal w-full max-w-lg rounded-[4rem] p-12 text-center border-red-500/20">
                                    <Icon name="ShieldAlert" className="w-20 h-20 mx-auto mb-8 text-red-600" />
                                    <h1 className="text-4xl font-black italic text-white uppercase mb-4">Espejo de Realidad</h1>
                                    <p className="text-[10px] text-neutral-500 font-bold uppercase tracking-widest mb-8">Has estado ausente {Math.floor(failurePorc / 20)} d√≠as</p>
                                    <div className="grid grid-cols-2 gap-4 mb-8">
                                        <div className="bg-black/50 p-6 rounded-3xl border border-neutral-800"><p className="text-[10px] font-black text-neutral-500 uppercase mb-2">Victorias</p><p className="text-3xl font-black text-blue-500">{habits.reduce((acc, h) => acc + h.history.length, 0)}</p></div>
                                        <div className="bg-black/50 p-6 rounded-3xl border border-neutral-800"><p className="text-[10px] font-black text-neutral-500 uppercase mb-2">Eficacia</p><p className="text-3xl font-black text-red-600">{getGlobalStats()}%</p></div>
                                    </div>
                                    {aiFeedback ? (
                                        <div className="space-y-6"><div className="p-6 bg-red-600/10 border border-red-600/20 rounded-3xl text-sm italic text-red-200 leading-relaxed">"{aiFeedback}"</div>{verdictValid && <button onClick={() => setShowJuez(false)} className="w-full bg-white text-black font-black py-6 rounded-3xl uppercase text-xs">Re-ingresar al Sistema</button>}</div>
                                    ) : (
                                        <div className="space-y-6">
                                            <textarea value={reflection} onChange={e => setReflection(e.target.value)} placeholder="¬øPor qu√© abandonaste tu proceso?..." className="w-full bg-black/50 border border-neutral-800 rounded-[2.5rem] p-7 text-white outline-none min-h-[160px]" />
                                            <button onClick={consultarAlJuez} className={`w-full font-black py-7 rounded-3xl uppercase text-xs tracking-[0.3em] bg-white text-black ${isAiLoading ? 'opacity-50' : ''}`} disabled={isAiLoading}>{isAiLoading ? 'DELIBERANDO...' : 'PRESENTAR DEFENSA'}</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        <footer className="mt-24 text-center pb-40"><p className="text-[10px] font-black text-neutral-800 uppercase tracking-[0.7em] px-6">SPLENDOR ‚Ä¢ v12.5 ‚Ä¢ M√âTRICAS DIN√ÅMICAS</p></footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
